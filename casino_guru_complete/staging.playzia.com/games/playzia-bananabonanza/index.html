<!DOCTYPE html>

<html lang="en">

    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8"/>

        <!-- mobile meta tags -->
        <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
        <meta name="apple-mobile-web-app-capable" content="yes"/>
        <meta name="apple-touch-fullscreen" content="yes"/>
        <meta name="msapplication-tap-highlight" content="no"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <meta name="mobile-web-app-capable" content="yes">

        <!-- styles -->
        <link rel="stylesheet" href="./assets/html/global.css?v=1.0.0">
        <link rel="stylesheet" href="./assets/html/vex/vex.css?v=1.0.0"/>
        <link rel="stylesheet" href="./assets/html/vex/vex-theme-plain.css?v=1.0.0"/>

        <meta name="msapplication-TileColor" content="#ffffff">
        <meta name="theme-color" content="#ffffff">

    </head>

    <body onload="loadGame()">
        <script>
            // WebSocket –º–æ–∫ –¥–ª—è –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–∞ - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ü–ï–†–í–´–ú!
            (function () {
                console.log('üéÆ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º WebSocket –º–æ–∫ –≤ –∏–≥—Ä–µ...');
                
                const listeners = (ws) => ({
                    open: () => {
                        console.log('üîå WebSocket –º–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω');
                        ws.onopen && ws.onopen({});
                    },
                    tick() {
                        if (ws.__closed) return;
                        
                        // –≠–º—É–ª–∏—Ä—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–π –∫—Ä–∞—à-—Ä–∞—É–Ω–¥ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ñ–∞–∑–∞–º–∏
                        const now = Date.now();
                        const roundPhase = ws.__phase || 'ROUND_RUNNING';
                        const multiplier = +(1 + Math.random() * 10).toFixed(2);
                        
                        // –û—Å–Ω–æ–≤–Ω–æ–π —Ç–∏–∫ —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–≥—Ä—ã
                        const gameTickPayload = {
                            cmd: 'game',
                            source: 'testgame',
                            data: {
                                body: {
                                    type: 'GAME_STATE',
                                    serverTime: now,
                                    state: roundPhase,
                                    multiplier: multiplier,
                                    gameState: 'ACTIVE',
                                    roundId: 'offline_round_' + now,
                                    balance: {
                                        totalBalance: 100000000, // –í —Ü–µ–Ω—Ç–∞—Ö
                                        currency: 'EUR',
                                        currencyMultiplier: 100
                                    },
                                    currency: 'EUR',
                                    rounds: [{
                                        status: 'active',
                                        currentMultiplier: multiplier,
                                        maxMultiplier: 0,
                                        timeToStartInSeconds: 0,
                                        roundId: 'offline_round_' + now,
                                        id: 'offline_round_' + now
                                    }],
                                    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫—Ä–∞—à-–∏–≥—Ä—ã
                                    gameInProgress: true,
                                    currentRound: {
                                        id: 'offline_round_' + now,
                                        status: 'active',
                                        currentMultiplier: multiplier,
                                        maxMultiplier: 0,
                                        timeToStartInSeconds: 0
                                    }
                                }
                            }
                        };
                        
                        console.log('üì° WebSocket –º–æ–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–≥—Ä–æ–≤–æ–π —Ç–∏–∫:', gameTickPayload);
                        ws.onmessage && ws.onmessage({ data: JSON.stringify(gameTickPayload) });
                        
                        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π —Ç–∏–∫
                        const systemTickPayload = {
                            type: 'SYSTEM_TICK',
                            serverTime: now,
                            ping: 'pong'
                        };
                        
                        setTimeout(() => {
                            ws.onmessage && ws.onmessage({ data: JSON.stringify(systemTickPayload) });
                        }, 100);
                        
                        setTimeout(() => listeners(ws).tick(), 1000);
                    },
                    close: () => {
                        console.log('üîå WebSocket –º–æ–∫ –æ—Ç–∫–ª—é—á–µ–Ω');
                        ws.onclose && ws.onclose({});
                    }
                });

                class MockWebSocket {
                    constructor(url) {
                        console.log('üîå –°–æ–∑–¥–∞–µ–º WebSocket –º–æ–∫ –¥–ª—è:', url);
                        this.url = url;
                        this.readyState = 0; // CONNECTING
                        this.__closed = false;
                        this.protocol = '';
                        this.extensions = '';
                        
                        // –≠–º—É–ª–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                        setTimeout(() => { 
                            if (!this.__closed) {
                                this.readyState = 1; // OPEN
                                listeners(this).open(); 
                                listeners(this).tick(); 
                            }
                        }, 100);
                    }
                    
                    send(data) { 
                        console.log('üì§ WebSocket –º–æ–∫ –ø–æ–ª—É—á–∏–ª:', data);
                        
                        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –æ—Ç–≤–µ—á–∞–µ–º –Ω–∞ –Ω–∏—Ö
                        try {
                            const message = JSON.parse(data);
                            console.log('üì• –ü–∞—Ä—Å–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ:', message);
                            
                            // –û—Ç–≤–µ—á–∞–µ–º –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã –∏–≥—Ä—ã
                            setTimeout(() => {
                                let response = null;
                                
                                if (message.cmd === 'game' && message.data?.body?.op === 'loadConfig') {
                                    // –û—Ç–≤–µ—Ç –Ω–∞ loadConfig - –ø–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å rtpVersion
                                    response = {
                                        cmd: 'game',
                                        source: 'testgame',
                                        data: {
                                            requestId: message.data.requestId,
                                            body: {
                                                success: true,
                                                action: 'start',
                                                config: {
                                                    rtpVersion: '96.50%',
                                                    buyBonusRtp: '96.50%',
                                                    maxWin: '5000x',
                                                    displayRTP: true,
                                                    maxWinProbability: '1:1000000',
                                                    jurisdiction: 'MGA',
                                                    stakes: [10, 20, 50, 100, 200, 500, 1000, 2000, 5000, 10000],
                                                    defaultStakeIndex: 3,
                                                    minSpinTime: 1000,
                                                    turboEnabled: true,
                                                    packageBuyEnabled: true,
                                                    stopEnabled: true,
                                                    autoplayEnabled: true,
                                                    rcEnabled: false,
                                                    rcInterval: 3600,
                                                    sessionTimeoutInSeconds: 1800,
                                                    maxExposure: 250000000,
                                                    minStake: 10,
                                                    maxStake: 10000,
                                                    displayClock: true,
                                                    autoplayLossLimitRequired: false,
                                                    currency: 'EUR',
                                                    currencyMultiplier: 100,
                                                    gameId: 'playzia-bananabonanza',
                                                    operatorCode: 'internal_testoperator',
                                                    language: 'EN'
                                                },
                                                balance: {
                                                    totalBalance: 100000000,
                                                    currency: 'EUR',
                                                    currencyMultiplier: 100,
                                                    mode: 'DEMO'
                                                },
                                                tokenData: {
                                                    operatorId: "internal_testoperator",
                                                    playerId: "offline_user_12345",
                                                    gameId: "playzia-bananabonanza",
                                                    mode: "DEMO",
                                                    currency: "EUR",
                                                    language: "EN",
                                                    currencyMultiplier: 100,
                                                    totalWin: 0,
                                                    totalBet: 0
                                                }
                                            }
                                        }
                                    };
                                } else if (message.cmd === 'systemping') {
                                    // –û—Ç–≤–µ—Ç –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø–∏–Ω–≥
                                    response = {
                                        cmd: 'systemping',
                                        source: 'systemping-test',
                                        data: {
                                            requestId: message.data.requestId,
                                            serverTimeInMS: Date.now(),
                                            success: true
                                        }
                                    };
                                } else if (message.cmd === 'game') {
                                    // –û–±—â–∏–π –æ—Ç–≤–µ—Ç –Ω–∞ –∏–≥—Ä–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
                                    const operation = message.data?.body?.op || 'unknown';
                                    
                                    if (operation === 'spin' || operation === 'bet') {
                                        // –û—Ç–≤–µ—Ç –Ω–∞ —Å—Ç–∞–≤–∫—É/—Å–ø–∏–Ω
                                        response = {
                                            cmd: 'game',
                                            source: 'testgame',
                                            data: {
                                                requestId: message.data.requestId,
                                                body: {
                                                    success: true,
                                                    currency: 'EUR',
                                                    balance: {
                                                        totalBalance: 100000000,
                                                        currency: 'EUR',
                                                        currencyMultiplier: 100
                                                    },
                                                    result: {
                                                        win: Math.random() > 0.5 ? Math.floor(Math.random() * 1000) + 100 : 0,
                                                        multiplier: +(1 + Math.random() * 5).toFixed(2)
                                                    }
                                                }
                                            }
                                        };
                                    } else {
                                        // –û–±—â–∏–π –æ—Ç–≤–µ—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ –∫–æ–º–∞–Ω–¥—ã
                                        response = {
                                            cmd: 'game',
                                            source: 'testgame',
                                            data: {
                                                requestId: message.data.requestId,
                                                body: {
                                                    success: true,
                                                    currency: 'EUR',
                                                    balance: {
                                                        totalBalance: 100000000,
                                                        currency: 'EUR',
                                                        currencyMultiplier: 100
                                                    },
                                                    message: `Command ${operation} processed successfully`
                                                }
                                            }
                                        };
                                    }
                                }
                                
                                if (response) {
                                    console.log('üì§ WebSocket –º–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç:', response);
                                    this.onmessage && this.onmessage({ 
                                        data: JSON.stringify(response) 
                                    });
                                }
                            }, 50); // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç–∏
                            
                        } catch (error) {
                            console.log('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ WebSocket —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
                        }
                    }
                    
                    close(code = 1000, reason = '') { 
                        console.log('üîå –ó–∞–∫—Ä—ã–≤–∞–µ–º WebSocket –º–æ–∫');
                        this.__closed = true; 
                        this.readyState = 3; // CLOSED
                        listeners(this).close(); 
                    }
                    
                    addEventListener(type, listener, options) {
                        if (type === 'open') this.onopen = listener;
                        if (type === 'message') this.onmessage = listener;
                        if (type === 'close') this.onclose = listener;
                        if (type === 'error') this.onerror = listener;
                    }
                    
                    removeEventListener(type, listener, options) {
                        if (type === 'open') this.onopen = null;
                        if (type === 'message') this.onmessage = null;
                        if (type === 'close') this.onclose = null;
                        if (type === 'error') this.onerror = null;
                    }
                }

                // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã WebSocket
                MockWebSocket.CONNECTING = 0;
                MockWebSocket.OPEN = 1;
                MockWebSocket.CLOSING = 2;
                MockWebSocket.CLOSED = 3;

                // –ü–µ—Ä–µ–∫—Ä—ã–≤–∞–µ–º WebSocket –ì–õ–û–ë–ê–õ–¨–ù–û
                window.WebSocket = MockWebSocket;
                window.MozWebSocket = MockWebSocket; // –î–ª—è Firefox
                
                console.log('‚úÖ WebSocket –º–æ–∫ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –≤ –∏–≥—Ä–µ!');
            })();
            
            function loadGame() {
                let app = new DO.App();
                app.hoelleConnector = {
                    OI:OperatorInterface,
                    RLX: {
                        on: on,
                        send: send,
                        configure:configure
                    }
                };
                app.init();
            }
        </script>

        <script src="../common/lib/hoelle/rlxfeim.js?v=1.0.0"></script>
        <script src="../common/lib/hoelle/operatorInterface.js?v=1.0.0"></script>
        <script src="../common/lib/jquery-1.11.3.min.js?v=1.0.0"></script>
        <script src="../common/lib/pixi.min.js?v=1.0.0"></script>
        <script src="../common/lib/pixi-spine.js?v=1.0.0"></script>
        <script src="../common/lib/howler.min.js?v=1.0.0"></script>
        <script src="../common/lib/TweenLite.min.js?v=1.0.0"></script>
        <script src="../common/lib/EasePack.min.js?v=1.0.0"></script>
        <script src="../common/lib/TimelineLite.min.js?v=1.0.0"></script>
        <script src="../common/lib/TweenMax.min.js?v=1.0.0"></script>
        <script src="../common/lib/screenfull.js?v=1.0.0"></script>
        <script src="../common/lib/webfont.min.js?v=1.0.0"></script>
        <script src="../common/lib/platform.js?v=1.0.0"></script>
        <script src="../common/lib/vex.js?v=1.0.0"></script>
        <script src="../common/lib/vex.dialog.js?v=1.0.0"></script>
        <script src="../common/lib/require.js?v=1.0.0"></script>
        <script src="../common/lib/iscoop-playzia-hoelle-1.0.0.js?v=1.0.0"></script>
        <script src="./src/app.js?v=1.0.0"></script>

    </body>

</html>